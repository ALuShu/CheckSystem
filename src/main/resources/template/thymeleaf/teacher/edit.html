<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>通知编辑</title>
    <link rel="stylesheet" href="../layui/css/layui.css" type="text/css">
</head>
<body class="layui-layout-body">
<input id="currentDepartment" style="display: none" th:value="${current.department}"/>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header layui-bg-gray">

        <div class="layui-logo" style="font-size: 20px; color: #393D49; cursor: pointer" onclick="index()">作业查重系统教师端
        </div>

        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="/teacher/personal" style="color: #393D49">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img"><span th:text="${current.realname}"></span>
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;">基本资料</a></dd>
                    <dd><a href="/teacher/edit">发布通知</a></dd>
                    <dd><a href="/teacher/update">修改密码</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item"><a id="logout" href="javascript:;" style="color: #393D49">注销</a></li>
        </ul>
    </div>

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
        <legend>编辑通知内容</legend>
    </fieldset>
    <form class="layui-form layui-form-pane" action="">

        <div class="layui-form-item">
            <label class="layui-form-label">标题</label>
            <div class="layui-input-inline">
                <input type="text" name="title" placeholder="(选填)" autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">发布人工号</label>
            <div class="layui-input-inline">
                <input type="text" name="publisher" th:value="${current.username}" disabled class="layui-input layui-disabled">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">提交路径</label>
            <div class="layui-input-inline">
                <input type="text" name="path" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">通知系别</label>
            <div class="layui-input-block">
                <select name="department" id="departmentSelect" lay-filter="departmentSelect">
                    <option value="">选择系别</option>
                    <option value="计算机系">计算机系</option>
                    <option value="软件系">软件系</option>
                    <option value="外语系">外语系</option>
                    <option value="国贸系">国贸系</option>
                    <option value="市场营销系">市场营销系</option>
                    <option value="电子系">电子系</option>
                    <option value="数码媒体系">数码媒体系</option>
                    <option value="游戏系">游戏系</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item" pane="">
            <label class="layui-form-label">通知类型</label>
            <div class="layui-input-block">
                <input type="radio" name="type" lay-filter="typeRadio" value="1" title="必修" checked="">
                <input type="radio" name="type" lay-filter="typeRadio" value="0" title="选修">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">通知内容</label>
            <div class="layui-input-block">
                <textarea id="content" placeholder="请输入内容" name="content" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn" lay-submit="" lay-filter="demo2">提交</button>
        </div>
    </form>
</div>


<!-- 方法 -->
<script src="../webjars/jquery/3.4.1/jquery.js"></script>
<script src="../layui/layui.js" type="text/javascript"></script>
<script th:inline="none">
    let currentDepartment = $("#currentDepartment").val();
    //根据用户系别修改默认的下拉选项
    $("#departmentSelect option:contains(" + currentDepartment + ")").attr('selected', true);
    $('#departmentSelect').attr('disabled', true);

    function index() {
        window.location = "/teacher/index"
    }

    $('#logout').click(function () {
        layer.confirm('确定退出系统吗',function () {
            window.location="/logout";
        })
    });

    layui.use(['form','table','element','layedit'], function () {
        var form = layui.form
            , element = layui.element
            , layedit = layui.layedit
            , table = layui.table;

        //监听提交
        form.on('submit(demo2)', function(data){
            if (data.field.title === ""){
                data.field.title = "通知"
            }
            layer.alert(JSON.stringify(data.field));
            $.ajax({
                url:'/teacher/push',
                method:'post',
                data:data.field,
                success:function (result) {
                    layer.alert(JSON.stringify(result.msg))
                }
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

        //layedit.build('content'); //建立编辑器

        //监听单选
        form.on('radio(typeRadio)', function(data){
            if (data.value === '0'){
                $("#departmentSelect option:contains(" + currentDepartment + ")").attr('selected', false);
                $('#departmentSelect').attr('disabled', false);

            }else {
                $("#departmentSelect option:contains(" + currentDepartment + ")").attr('selected', true);
                $('#departmentSelect').attr('disabled', true);
            }
            form.render("select");
        });

    });
</script>
</body>
</html>